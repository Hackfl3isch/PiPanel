<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Smart Panel</title>

    <!-- Google Fonts f√ºr Emojis -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">

    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css"/>

    <!-- Eigenes CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #111;
            color: #fff;
        }

        .card {
            background-color: #222;
            border-radius: 12px;
            padding: 20px;
            margin: 20px auto;
            width: 95%;
            max-width: 1000px;
            text-align: center;
        }

        .emoji { font-family: 'Noto Color Emoji', Arial, sans-serif; }

        /* Wetter-Slide: zwei Frames nebeneinander */
        .wetter-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .wetter-frame {
            background: #333;
            border-radius: 10px;
            padding: 15px;
            flex: 1;
            min-width: 250px;
        }

        .frame-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.2em;
            text-align: center;
        }

        .frame-item {
            margin: 5px 0;
        }

        /* Spritpreise Grid */
        .sprit-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-auto-rows: auto;
            gap: 20px;
            margin-top: 20px;
        }

        .sprit-grid .second-row {
            grid-column: span 3;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .station-box {
            background: #333;
            border-radius: 10px;
            padding: 15px;
        }

        .station-name {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
            text-align: center;
        }

        .fuel {
            margin: 5px 0;
        }

        h1 { margin-bottom: 20px; }
        p { margin: 5px 0; }

        .swiper { width: 100vw; height: 100vh; }
        .wetter-slide { overflow: hidden; -webkit-user-select: none; user-select: none; }
        .sprit-slide { overflow: hidden; -webkit-user-select: none; user-select: none; }
    </style>
</head>
<body>

<div class="swiper">
    <div class="swiper-wrapper">

        <!-- Wetter Slide -->
        <div class="swiper-slide wetter-slide">
            <div class="card">
                <h1 class="emoji">üå§ Wetter</h1>
                <div class="wetter-container">
                    <!-- Linker Frame: Heute -->
                    <div class="wetter-frame">
                        <div class="frame-title">Wetter Heute</div>
                        <div class="frame-item">Aktuell: <span id="wetterStatus">{{ wetter['WetterStatusAktuell'] }}</span></div>
                        <div class="frame-item">Momentane Temperatur: <span id="tempAktuell">{{ wetter['TemperaturMomentan'] }}</span> ¬∞C</div>
                        <div class="frame-item">Min heute: <span id="tempMinHeute">{{ wetter['TemperaturMinimalHeute'] }}</span> ¬∞C</div>
                        <div class="frame-item">Max heute: <span id="tempMaxHeute">{{ wetter['TemperaturMaximalHeute'] }}</span> ¬∞C</div>
                        <div class="frame-item"><span class="emoji">üåÖ</span> Sonnenaufgang: <span id="sonnenaufgang">{{ wetter['SonnenaufgangHeute'] }}</span></div>
                        <div class="frame-item"><span class="emoji">üåá</span> Sonnenuntergang: <span id="sonnenuntergang">{{ wetter['SonnenuntergangHeute'] }}</span></div>
                    </div>

                    <!-- Rechter Frame: Morgen -->
                    <div class="wetter-frame">
                        <div class="frame-title">Wetter Morgen</div>
                        <div class="frame-item">Min morgen: <span id="tempMinMorgen">{{ wetter['TemperaturMinimalMorgen'] }}</span> ¬∞C</div>
                        <div class="frame-item">Max morgen: <span id="tempMaxMorgen">{{ wetter['TemperaturMaximalMorgen'] }}</span> ¬∞C</div>
                        <div class="frame-item"><span class="emoji">üåÖ</span> Sonnenaufgang Morgen: <span id="sonnenaufgangmorgen">{{ wetter['SonnenaufgangMorgen'] }}</span></div>
                        <div class="frame-item"><span class="emoji">üåá</span> Sonnenuntergang Morgen: <span id="sonnenuntergangmorgen">{{ wetter['SonnenuntergangMorgen'] }}</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Spritpreise Slide -->
        <div class="swiper-slide sprit-slide">
            <div class="card">
                <h1 class="emoji">‚õΩ Spritpreise</h1>
                {% set tankstellen = {
                    "BFT R√∂srath": ["BFT_R√∂srath_Diesel","BFT_R√∂srath_E10","BFT_R√∂srath_E5"],
                    "JET": ["JET_Diesel","JET_E10","JET_E5"],
                    "BFT Hoffnungsthal": ["BFT_Hoffnungsthal_Diesel","BFT_Hoffnungsthal_E10","BFT_Hoffnungsthal_E5"],
                    "Total": ["Total_Diesel","Total_E10","Total_E5"],
                    "Mundorf": ["Mundorf_Diesel","Mundorf_E10","Mundorf_E5"]
                } %}

                <div class="sprit-grid">
                    {% set first_row = ["BFT R√∂srath", "JET", "BFT Hoffnungsthal"] %}
                    {% set second_row = ["Total", "Mundorf"] %}

                    {% for station in first_row %}
                    <div class="station-box">
                        <div class="station-name">{{ station }}</div>
                        {% for alias in tankstellen[station] %}
                            {% if alias in sprit %}
                                {% set typ = alias.split('_')[-1] %}
                                <div class="fuel">{{ typ }}: <span id="{{ alias }}">{{ sprit[alias].preis }} ‚Ç¨/L</span></div>
                            {% else %}
                                {% set typ = alias.split('_')[-1] %}
                                <div class="fuel">{{ typ }}: ‚Äì</div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% endfor %}

                    <div class="second-row">
                        {% for station in second_row %}
                        <div class="station-box">
                            <div class="station-name">{{ station }}</div>
                            {% for alias in tankstellen[station] %}
                                {% if alias in sprit %}
                                    {% set typ = alias.split('_')[-1] %}
                                    <div class="fuel">{{ typ }}: <span id="{{ alias }}">{{ sprit[alias].preis }} ‚Ç¨/L</span></div>
                                {% else %}
                                    {% set typ = alias.split('_')[-1] %}
                                    <div class="fuel">{{ typ }}: ‚Äì</div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
	<!-- PV Slide -->
        <div class="swiper-slide solar-slide">
            <div class="card">
                <h1 class="emoji">‚òÄÔ∏è PV-Anlage</h1>
                <div class="frame-container">
                    <div class="frame">
                        <h2>Batterie</h2>
                        <p>F√ºllstand Akku: <span id="SolarSOC">{{ solar['SolarSOC'].wert if 'SolarSOC' in solar else '-' }}%</span></p>
                    </div>
                    <div class="frame">
                        <h2>PV-Ertrag</h2>
                        <p>PV Ost: <span id="PV_Ost">{{ solar['PV_Ost'].wert if 'PV_Ost' in solar else '-' }} kW</span></p>
                        <p>PV West: <span id="PV_West">{{ solar['PV_West'].wert if 'PV_West' in solar else '-' }} kW</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Aktien Slide -->
        <div class="swiper-slide">
            <div class="card">
                <h1 class="emoji">üìà Aktien</h1>
                <p>Demn√§chst...</p>
            </div>
        </div>

    </div>
    <div class="swiper-pagination"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<script>
    const swiper = new Swiper('.swiper', {
        direction: 'horizontal',
        loop: true,
        pagination: { el: '.swiper-pagination', clickable: true }
    });

    function updateWetter() {
        fetch('/api/wetter')
            .then(res => res.json())
            .then(data => {
                document.getElementById('wetterStatus').innerText = data.WetterStatusAktuell;
                document.getElementById('tempAktuell').innerText = data.TemperaturMomentan;
                document.getElementById('tempMinHeute').innerText = data.TemperaturMinimalHeute;
                document.getElementById('tempMaxHeute').innerText = data.TemperaturMaximalHeute;
                document.getElementById('tempMinMorgen').innerText = data.TemperaturMinimalMorgen;
                document.getElementById('tempMaxMorgen').innerText = data.TemperaturMaximalMorgen;
                document.getElementById('sonnenaufgang').innerText = data.SonnenaufgangHeute;
                document.getElementById('sonnenuntergang').innerText = data.SonnenuntergangHeute;
                document.getElementById('sonnenaufgangmorgen').innerText = data.SonnenaufgangMorgen;
                document.getElementById('sonnenuntergangmorgen').innerText = data.SonnenuntergangMorgen;
            });
    }

    function updateSprit() {
        fetch('/api/sprit')
            .then(res => res.json())
            .then(data => {
                const tankstellen = {
                    "BFT R√∂srath": ["BFT_R√∂srath_Diesel","BFT_R√∂srath_E10","BFT_R√∂srath_E5"],
                    "JET": ["JET_Diesel","JET_E10","JET_E5"],
                    "BFT Hoffnungsthal": ["BFT_Hoffnungsthal_Diesel","BFT_Hoffnungsthal_E10","BFT_Hoffnungsthal_E5"],
                    "Total": ["Total_Diesel","Total_E10","Total_E5"],
                    "Mundorf": ["Mundorf_Diesel","Mundorf_E10","Mundorf_E5"]
                };
                for (const [station, aliases] of Object.entries(tankstellen)) {
                    aliases.forEach(alias => {
                        const element = document.getElementById(alias);
                        if (element && data[alias]) {
                            element.innerText = data[alias].preis + ' ‚Ç¨/L';
                        }
                    });
                }
            });
    }

// PV-Daten aktualisieren
    function updateSolar() {
        fetch('/api/solar')
            .then(res => res.json())
            .then(data => {
                ['SolarSOC','PV_Ost','PV_West'].forEach(alias => {
                    const element = document.getElementById(alias);
                    if (element && data[alias]) {
                        element.innerText = data[alias].wert + (alias=='SolarSOC' ? '%' : ' kW');
                    }
                });
            });
    }

    updateWetter();
    updateSprit();
    updateSolar();

    setInterval(updateWetter, 300000);
    setInterval(updateSprit, 300000);
    setInterval(updateSolar, 300000);
</script>

</body>
</html>
